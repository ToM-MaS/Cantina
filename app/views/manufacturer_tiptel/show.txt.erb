	<% if @phone != nil %>
<%
key_map = {
:"BLF" => "16",
:"Speed dial" => "13",
:"Action	Url" => "17",
:"Line"	=> "15"
}
dtmf_map = {
:"rfc2833" => "1",
:"inband" => "0",
:"info" => "2"
}
codec_map = {
:"ulaw"  => "PCMU",
:"alaw"  => "PCMA",
:"g722"  => "G722",
:"g723"  => "G723_53",
:"g726"  => "G726-32",
:"g729"  => "G729"
}
cmapping_map = {
:"PCMU"    => "0",
:"PCMA"    => "8",
:"G722"    => "9",
:"G723_53" => "4",
:"G726-32" => "2",
:"G729"    => "18"
}
@phone.provisioning_log_entries.create(:succeeded => true, :memo => "Phone got config")
%>
<% @phone.sip_accounts.each do |sip_account| %>
[account]
path=/yealink/config/voip/sipAccount<%= sip_account.position - 1 %>.cfg
Enable=1
Label=<%= sip_account.user %>
Username=<%= sip_account.user %>
AuthName=<%= sip_account.auth_user %>
Password=<%= sip_account.password %>
DisplayName=<%= sip_account.display_name %>
SIPServerHost=<%= sip_account.registrar %>
SIPServerPort=<%= sip_account.registrar_port %>
<% if sip_account.outbound_proxy != "" %>
UseOutboundProxy=1
OutboundHost=<%= sip_account.outbound_proxy %>
OutboundPort=<%= sip_account.outbound_proxy_port %>
<% end %>
RegisterLine=1
RegisterMac=1

[ DTMF ]
path = /config/voip/sipAccount<%= sip_account.position - 1 %>.cfg
DTMFInbandTransfer=<%= dtmf_map[ :"#{sip_account.dtmf_mode}" ] %>

<% if sip_account.codecs.count != 0 %>
<% sip_account.sip_account_codecs.each do |c| %>
<% if codec_map[ :"#{c.codec.name}" ] != nil %>
[audio<%= c.position %>.cfg]
path=/config/voip/sipAccount<%= sip_account.position - 1 %>.cfg
enable = 1
PayloadType = <%= codec_map[ :"#{c.codec.name}" ] %>
priority = <%= "#{c.position}" %>
rtpmap = <%= cmapping_map[ :"#{codec_map[ :"#{c.codec.name}" ]}"]%>
<% end %>
<% end %>
<% end %>
<% @phone.sip_accounts.where( :position => sip_account.position).first.phone_keys.each do |phone_key| %>
<% if key_map[ :"#{phone_key.phone_key_function_definition.name}" ] != nil %>
[<%= phone_key.phone_model_key.name %>]
path=/config/vpPhone/vpPhone.ini
Value=<%= phone_key.value %>
Label=<%= phone_key.value %>
DKtype=<%= key_map[ :"#{phone_key.phone_key_function_definition.name}"] %>
Line=<%= sip_account.position - 1 %>
<% end %>
<% end %>

<% (@phone.phone_model.phone_model_keys.collect {|x| x.id} - @phone.phone_keys.collect {|x| x.phone_model_key_id}).flatten.each do |del_id| %>
[<%= @phone.phone_model.phone_model_keys.where("id = #{del_id}" ).first.name %>]
path=/config/vpPhone/vpPhone.ini
Value=
Label=
DKtype=0

<% end %>
<% end %>
<% else %>
No Phone found!
<% end %>